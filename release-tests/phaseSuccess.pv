(* set debugOutput = true. *)

channel c.
type key.
fun enc(bitstring,key):bitstring.
free initKey:key.

free beep1:bitstring[private].
free beep2:bitstring[private].

query attacker(beep1).

cell s1 := initKey.
cell s2 := initKey.

reduc forall m:bitstring, k:key; dec(enc(m,k),k)= m.


let S1 =
read s1 as k1:key;
in(c, m1:bitstring);
out(c, dec(m1,k1)).

let S2 =
phase 1;
read s2 as k2:key;
in(c, m2:bitstring);
out(c, dec(m2,k2)).

process 
new k1:key;
new k2:key;
s1 := k1;
s2 := k2;
(S1 | S2 |
phase 1;out(c,enc(beep1,k1)); out(c,enc(beep2,k2)))





